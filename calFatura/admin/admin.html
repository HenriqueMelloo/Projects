<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Incluindo o link para o arquivo CSS -->
    <link rel="stylesheet" type="text/css" href="../admin/style_admin.css">
    <title>Visualizar e Deletar Usuários</title>
</head>

<body>
    <h1>Usuários Cadastrados</h1>
    <table id="userTable">
        <thead>
            <tr>
                <th>Nome Completo</th>
                <th>Data de Nascimento</th>
                <th>Nome da Mãe</th>
                <th>Código da Unidade</th>
                <th>Username</th>
                <th>Password</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="userList">
        </tbody>
    </table>
    <button id="exportToExcelBtn">Exportar para Excel</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        var users = JSON.parse(localStorage.getItem('users')) || [];

        function updateUsersList() {
            var userList = document.getElementById("userList");
            userList.innerHTML = "";

            users.forEach(function (user, index) {
                var tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${user.nomeCompleto}</td>
                    <td>${user.dataNascimento}</td>
                    <td>${user.nomeMae}</td>
                    <td>${user.idUnidade}</td>
                    <td>${user.username}</td>
                    <td>${user.password}</td>
                    <td><button onclick="deleteUser(${index})">Excluir</button></td>
                `;
                userList.appendChild(tr);
            });
        }

        function deleteUser(index) {
            users.splice(index, 1);
            localStorage.setItem('users', JSON.stringify(users));
            updateUsersList();
        }

        function exportToExcel() {
            var wb = XLSX.utils.book_new();
            wb.Props = {
                Title: "Cadastro de Usuários",
                Subject: "Cadastro de Usuários",
                Author: "Seu Nome",
                CreatedDate: new Date()
            };
            wb.SheetNames.push("Usuários");

            var ws_data = users.map(function (user) {
                return [user.nomeCompleto, user.dataNascimento, user.nomeMae, user.idUnidade, user.username, user.password];
            });
            var ws = XLSX.utils.aoa_to_sheet([
                ["Nome Completo", "Data de Nascimento", "Nome da Mãe", "Código da Unidade", "Username", "Password"]
            ].concat(ws_data));
            wb.Sheets["Usuários"] = ws;

            var wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });

            function s2ab(s) {
                var buf = new ArrayBuffer(s.length);
                var view = new Uint8Array(buf);
                for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }

            saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), 'usuarios.xlsx');
        }

        var saveAs = function (blob, filename) {
            var elem = window.document.createElement('a');
            elem.href = window.URL.createObjectURL(blob);
            elem.download = filename;
            document.body.appendChild(elem);
            elem.click();
            document.body.removeChild(elem);
        }

        document.getElementById("exportToExcelBtn").addEventListener("click", exportToExcel);

        updateUsersList();
    </script>
</body>

</html>