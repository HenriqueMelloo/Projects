<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calfat - Calculadora de Fatura</title>
    <link rel="stylesheet" type="text/css" href="../styles/styles_index.css">
</head>

<body>
    <div id="container">
        <h1>Calculadora de Fatura</h1>
        <label for="leitAnterior">Leitura Anterior:</label>
        <input type="number" placeholder="Leitura Anterior" id="leitAnterior" required>
        <label for="leitAtual">Leitura Atual:</label>
        <input type="number" placeholder="Leitura Atual" id="leitAtual" required>
        <input type="checkbox" id="incluiPisConfins">
        <label for="incluiPisConfins">Incluir PIS e COFINS</label>
        <button onclick="calculaFatura()">Calcular</button>
        <p id="resultado"></p>
        <br>
        <a href="#" onclick="logout()">Logout</a>
    </div>

    <script>
        function calculaFatura() {
            var leitAnterior = parseFloat(document.getElementById("leitAnterior").value);
            var leitAtual = parseFloat(document.getElementById("leitAtual").value);

            if (isNaN(leitAnterior) || isNaN(leitAtual)) {
                alert('Por favor, insira valores válidos para as leituras.');
                return;
            }

            var consumo = (leitAtual - leitAnterior) * 0.834850;
            var iluminacao_publica = consumo * 0.09342;
            var valor_final = consumo + iluminacao_publica;

            var incluiPisConfins = document.getElementById("incluiPisConfins").checked;
            if (incluiPisConfins) {
                var pis = consumo * 0.00588;
                var confins = consumo * 0.02845;
                valor_final += pis + confins;
            }

            document.getElementById("resultado").innerText = "O valor da fatura é: R$ " + valor_final.toFixed(2);
        }

        // Função para deletar o usuário atual
        function deleteUser() {
            var confirmacao = confirm("Tem certeza que deseja deletar sua conta?");
            if (confirmacao) {
                var currentUser = JSON.parse(localStorage.getItem('currentUser'));
                var users = JSON.parse(localStorage.getItem('users')) || [];

                // Remover o usuário da lista de usuários
                var updatedUsers = users.filter(function(user) {
                    return user.username !== currentUser.username;
                });

                localStorage.setItem('users', JSON.stringify(updatedUsers));
                localStorage.removeItem('currentUser');
                alert("Usuário deletado com sucesso.");
                window.location.href = "login.html"; // Redirecionar para a página de login
            }
        }

        // Função para fazer logout
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = "login.html"; // Redirecionar para a página de login
        }
    </script>
</body>

</html>
